<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!--iPhone preview -->
  <meta property="og:title" content="ETL Language Showdown Part 3" />
  <meta property="og:image" content="/" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      ETL Language Showdown Part 3 &middot; dimroc
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/tagging.css">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Javascript -->
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script src="/public/javascript/detectmobilebrowser.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <meta name="google-site-verification" content="KFJOcbe4F4sAQcx11yd_6hmxu0DVdy6ZgI7y6TFK8VU" />
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43559997-2', 'auto');
  ga('send', 'pageview');
</script>

</head>


  <body class="sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Blog</a>
    <a class="sidebar-nav-item" href="https://github.com/dimroc">GitHub</a>
    <a class="sidebar-nav-item" href="https://experiments.dimroc.com">Experiments</a>

    

    
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://twitter.com/dimroc">@dimroc</a>
  </nav>

  <div class="sidebar-item">
    <p>Tags</p>
  </div>

  <nav class="sidebar-nav">
    
    
      <a class="sidebar-nav-item" href=/tag/webgl/>webgl</a>
    
      <a class="sidebar-nav-item" href=/tag/javascript/>javascript</a>
    
      <a class="sidebar-nav-item" href=/tag/twitter/>twitter</a>
    
      <a class="sidebar-nav-item" href=/tag/nyc/>nyc</a>
    
      <a class="sidebar-nav-item" href=/tag/elasticsearch/>elasticsearch</a>
    
      <a class="sidebar-nav-item" href=/tag/ios/>ios</a>
    
      <a class="sidebar-nav-item" href=/tag/ruby/>ruby</a>
    
      <a class="sidebar-nav-item" href=/tag/elixir/>elixir</a>
    
      <a class="sidebar-nav-item" href=/tag/golang/>golang</a>
    
      <a class="sidebar-nav-item" href=/tag/scala/>scala</a>
    
      <a class="sidebar-nav-item" href=/tag/etl/>etl</a>
    
      <a class="sidebar-nav-item" href=/tag/swift/>swift</a>
    
      <a class="sidebar-nav-item" href=/tag/testing/>testing</a>
    
      <a class="sidebar-nav-item" href=/tag/rails/>rails</a>
    
      <a class="sidebar-nav-item" href=/tag/python/>python</a>
    
      <a class="sidebar-nav-item" href=/tag/business/>business</a>
    
      <a class="sidebar-nav-item" href=/tag/go/>go</a>
    
      <a class="sidebar-nav-item" href=/tag/docker/>docker</a>
    
      <a class="sidebar-nav-item" href=/tag/react/>react</a>
    
      <a class="sidebar-nav-item" href=/tag/tutum/>tutum</a>
    
      <a class="sidebar-nav-item" href=/tag/aws/>aws</a>
    
      <a class="sidebar-nav-item" href=/tag/machine-learning/>machine-learning</a>
    
      <a class="sidebar-nav-item" href=/tag/angular/>angular</a>
    
      <a class="sidebar-nav-item" href=/tag/finance/>finance</a>
    
      <a class="sidebar-nav-item" href=/tag/books/>books</a>
    
      <a class="sidebar-nav-item" href=/tag/octave/>octave</a>
    
      <a class="sidebar-nav-item" href=/tag/kubernetes/>kubernetes</a>
    
      <a class="sidebar-nav-item" href=/tag/coreml/>coreml</a>
    
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2023. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h2 class="masthead-title">
            <a href="/" title="Home">dimroc</a>
            <small>blog</small>
            <span class="masthead-links">
              <a href="https://experiments.dimroc.com" title="Experiments">See Experiments</a>
            </span>
          </h2>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">ETL Language Showdown Part 3</h1>
  <span class="post-date">14 Nov 2015</span>
  <span class="post-comments"><a href="#disqus_thread"></a></span>
  <p><em>This article is a continuation of the <a href="https://en.wikipedia.org/wiki/Extract,_transform,_load">Extract-Transform-Load (ETL)</a> showdown series.
Check these posts out for additional context and check out the <a href="https://github.com/dimroc/etl-language-comparison">repo</a>.</em></p>

<ul>
  <li><em><a href="/2014/09/29/etl-language-showdown/">Comparing Golang, Scala, Elixir and Ruby for ETL</a></em></li>
  <li><em><a href="/2015/05/07/etl-language-showdown-pt2">Comparing Golang, Scala, Elixir, Ruby, and now Python3 for ETL: Part 2</a></em></li>
</ul>

<hr />

<p><em>Analyses and discussions done in this ETL series have led to the following language pull requests:</em></p>

<ol>
  <li><em><a href="https://github.com/erlang/otp/pull/771">Add BIF binary:split/2,3 to Erlang</a></em></li>
  <li><em><a href="https://github.com/golang/go/issues/13288">Improve case insensitive regex in Golang</a></em></li>
</ol>

<hr />

<p>In this post, we will compare a Map Reduce solution to count the number of times <code class="language-plaintext highlighter-rouge">knicks</code>
is mentioned in ~40M tweets spanning multiple files. This originally came about as a way to compare vanilla
<a href="https://en.wikipedia.org/wiki/Global_interpreter_lock">GIL-bound</a> Ruby implementations against Scala
and Golang. It has since evolved into a <a href="https://github.com/dimroc/etl-language-comparison">repo of idiomatic ETL solutions</a>
for a variety of languages (ten at the time of this writing).</p>

<h3 id="langauges-covered">Langauges Covered</h3>

<table>
<tr> <th>Language</th><th>Owner</th> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/ruby">Ruby</a></td><td> </td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/golang">Golang</a></td><td></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/scala">Scala</a></td><td></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/nim">Nim</a></td><td></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/nodejs">Node</a></td><td></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/php">PHP</a></td><td></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/erlang">Erlang</a></td><td><a href="https://github.com/potatosalad">potatosalad</a></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/elixir">Elixir</a></td><td><a href="https://github.com/josevalim">josevalim</a></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/rust">Rust</a></td><td><a href="https://github.com/potatosalad">potatosalad</a></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/python">Python</a></td><td></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/csharp">C#</a></td><td><a href="https://github.com/mganss">mganss</a></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/shell">shell</a></td><td><a href="https://github.com/mganss">mganss</a></td> </tr>
<tr> <td><a href="https://github.com/dimroc/etl-language-comparison/tree/master/perl">perl</a></td><td><a href="https://github.com/sitaramc">sitaramc</a></td> </tr>
</table>

<p><em>Hype up your language by improving the current implementation. Give me a shout by <a href="https://github.com/dimroc/etl-language-comparison/issues">raising an issue</a> to become an owner.</em></p>

<h2 id="shortcuts-led-to-apple-and-orange-comparisons">Shortcuts led to apple and orange comparisons</h2>

<p>During this adventure, my Golang solution wasn’t as performant as I had hoped because the regex
library couldn’t compete with Scala’s. As a result, I introduced the first apple to orange comparison by allowing Golang to use substrings.</p>

<p>One can’t help but find the fastest solution possible, and this story continued with other languages and pull requests.
Reference implementations were accompanied with optimized solutions taking shortcuts, and I couldn’t turn away such sweet code.</p>

<p>Even when sticking to the reference solution, it has becoming increasingly difficult to keep the implementations consistent across languages
because certain idioms sway solutions in different directions.</p>

<h3 id="examples-of-shortcuts">Examples of shortcuts</h3>

<ol>
  <li>PHP takes a shortcut by using <code class="language-plaintext highlighter-rouge">stripos</code> that only works on ASCII, not Unicode.</li>
  <li>Regex comparison as opposed to substring checks.</li>
  <li>Loading file contents into memory as opposed to streaming.</li>
  <li>Having the master or supervisor keep track of the results so there is effectively no reduction step.</li>
  <li>Leveraging binary pattern matching as opposed to regular regex.</li>
</ol>

<p>Here are the previous implementations described in <a href="/2015/05/07/etl-language-showdown-pt2/">part 2 of the ETL showdown</a>:</p>

<div height="800px">
  <canvas id="languageChart"></canvas>
</div>

<h1 id="takeaway">Takeaway</h1>

<p>The results have a healthy amount of variety. Going into <a href="/2014/09/29/etl-language-showdown/">part 1</a>, it was believed that
the results of multi-threaded approaches would be the same because the problem would be IO bound. Well, that was wrong.
Instead of using this as a speed comparison across languages, use this repo as a reference for writing idiomatic ETL solutions in the language of your choice.
<a href="https://github.com/dimroc/etl-language-comparison">Check out the repo.</a></p>

<p>In order to promote consistency across implementations, I’ve introduced the following:</p>

<h3 id="rules-of-reference-implementation">Rules of Reference Implementation</h3>

<ol>
  <li>Stream input from files.</li>
  <li>Use Regular Expressions to check for the presence of <code class="language-plaintext highlighter-rouge">knicks</code>.</li>
  <li>Have multiple mappers, but one reducer.</li>
  <li>Each individual worker holds its results in a hash and sends that final hash back for reduction.</li>
</ol>

<h3 id="new-school-language-additions">New School: Language Additions</h3>

<div height="800px">
  <canvas id="languageChart2"></canvas>
</div>

<h2 id="new-school-observations-and-shortcuts">New School Observations and Shortcuts</h2>

<p>We’ve since added even more languages, each with their own nuances.
<a href="http://nim-lang.org/">Nim</a> is a newcomer I’ve never heard of but it performed surprisingly well.
Below you’ll find some notes on each implementation.</p>

<h3 id="erlang"><a href="https://github.com/dimroc/etl-language-comparison/tree/master/erlang">Erlang</a></h3>

<ol>
  <li>Leverages <a href="http://www.erlang.org/doc/efficiency_guide/binaryhandling.html">Binary Pattern Matching</a>.</li>
  <li>Holds all data in memory as opposed to streaming input line by line.</li>
</ol>

<h3 id="nim"><a href="https://github.com/dimroc/etl-language-comparison/tree/master/nim">Nim</a></h3>

<ol>
  <li>Implementation seems identical to the ruby version (streaming input with regex but using multiple cores) and it is blazing fast. The first I’ve heard of <a href="http://nim-lang.org/">Nim</a>.</li>
</ol>

<h3 id="rust"><a href="https://github.com/dimroc/etl-language-comparison/tree/master/rust">Rust</a></h3>

<ol>
  <li>Regex solution is identical to reference implementation.</li>
  <li>Substring solution only deals with ASCII.</li>
  <li>Man is it fast. Would love someone to take another look at the Rust implementation to see how it might be taking shortcuts against the reference implementation.</li>
</ol>

<h3 id="php"><a href="https://github.com/dimroc/etl-language-comparison/tree/master/php">PHP</a></h3>

<ol>
  <li>Only doing substring checks against ASCII.</li>
  <li>Single threaded.</li>
  <li>Included just to grow the library of implementations. Improvements and pull requests are welcome.</li>
</ol>

<h3 id="node-js"><a href="https://github.com/dimroc/etl-language-comparison/tree/master/nodejs">Node JS</a></h3>

<ol>
  <li>Uses <a href="https://nodejs.org/api/cluster.html">cluster</a> to get around the <a href="https://en.wikipedia.org/wiki/Global_interpreter_lock">Global Interpreter Lock (GIL)</a>.</li>
  <li>The workers communicate a match to the cluster master, effectively skipping the reduction step.</li>
</ol>

<h2 id="call-to-action">Call To Action</h2>

<ul>
  <li>The number of languages being covered has grown past my ability to maintain. If you would like to <strong>own</strong> a particular language’s implementation,
please let me know and feel free to submit PR’s my way.</li>
  <li>Another area of interest is memory consumption. Tracking memory consumption can be tricky.
For example, runtimes can aggresssively grab memory despite the application not using all of it. It would
be great to track peak memory usage for the runs, so that we can now plot memory consumption along with execution time.</li>
</ul>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>

<script>
(function() {
    var options = {
      maintainAspectRatio: true,
      responsive: true
    };

    var results = {
      "ruby": 31.426,
      "ruby-parallel": 7.602,
      "jruby": 12.915,
      "elixir": 10.959,
      "go-substring": 6.040,
      "go-regex": 18.637,
      "python3-pool": 7.331,
      "scala-akka": 8,
      "scala-parallel": 8.5,
      "scala-future": 8.5,
    };

    var results2 = {
      "ruby": 31.426,
      "nim": 2.813,
      "nodejs-cluster": 2.582,
      "php-ascii-single-thread": 10.901,
      "erlang-unsafe-cheats": 2.589,
      "erlang-binary": 4.081,
      "erlang-regex": 5.874,
      "rust-substring": 1.960,
      "rust-regex": 1.382
    };

    function createBarChart(results, canvasId) {
      var data = {
          labels: $.map(results, function(key, element) { return element }),
          datasets: [ { data: $.map(results, function(key, element) { return key }) } ]
      };

      var ctx = document.getElementById(canvasId).getContext("2d");
      var myBarChart = new Chart(ctx).Bar(data, options);
    }

    createBarChart(results, "languageChart");
    createBarChart(results2, "languageChart2");

})();
</script>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2019/12/31/books-worth-reading-2019/">
            Books Worth Reading 2019
            <small>31 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/12/31/books-worth-reading-2018/">
            Books Worth Reading 2018
            <small>31 Dec 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/08/12/counting-crowds-with-coreml/">
            Moving AI from the Cloud to the Edge with Crowd Count and Apple's Core ML
            <small>12 Aug 2018</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dimroc'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'dimroc'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>


  </body>
</html>
