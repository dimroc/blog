<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!--iPhone preview -->
  <meta property="og:title" content="Comparing Golang, Scala, Elixir, Ruby, and now Python3 for ETL: Part 2" />
  <meta property="og:image" content="/" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Comparing Golang, Scala, Elixir, Ruby, and now Python3 for ETL: Part 2 &middot; dimroc
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/tagging.css">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Javascript -->
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script src="/public/javascript/detectmobilebrowser.js"></script>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <meta name="google-site-verification" content="KFJOcbe4F4sAQcx11yd_6hmxu0DVdy6ZgI7y6TFK8VU" />
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43559997-2', 'auto');
  ga('send', 'pageview');
</script>

</head>


  <body class="sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Blog</a>
    <a class="sidebar-nav-item" href="https://github.com/dimroc">GitHub</a>
    <a class="sidebar-nav-item" href="https://experiments.dimroc.com">Experiments</a>

    

    
    
      
        
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="https://twitter.com/dimroc">@dimroc</a>
  </nav>

  <div class="sidebar-item">
    <p>Tags</p>
  </div>

  <nav class="sidebar-nav">
    
    
      <a class="sidebar-nav-item" href=/tag/webgl/>webgl</a>
    
      <a class="sidebar-nav-item" href=/tag/javascript/>javascript</a>
    
      <a class="sidebar-nav-item" href=/tag/twitter/>twitter</a>
    
      <a class="sidebar-nav-item" href=/tag/nyc/>nyc</a>
    
      <a class="sidebar-nav-item" href=/tag/elasticsearch/>elasticsearch</a>
    
      <a class="sidebar-nav-item" href=/tag/ios/>ios</a>
    
      <a class="sidebar-nav-item" href=/tag/ruby/>ruby</a>
    
      <a class="sidebar-nav-item" href=/tag/elixir/>elixir</a>
    
      <a class="sidebar-nav-item" href=/tag/golang/>golang</a>
    
      <a class="sidebar-nav-item" href=/tag/scala/>scala</a>
    
      <a class="sidebar-nav-item" href=/tag/etl/>etl</a>
    
      <a class="sidebar-nav-item" href=/tag/swift/>swift</a>
    
      <a class="sidebar-nav-item" href=/tag/testing/>testing</a>
    
      <a class="sidebar-nav-item" href=/tag/rails/>rails</a>
    
      <a class="sidebar-nav-item" href=/tag/python/>python</a>
    
      <a class="sidebar-nav-item" href=/tag/business/>business</a>
    
      <a class="sidebar-nav-item" href=/tag/go/>go</a>
    
      <a class="sidebar-nav-item" href=/tag/docker/>docker</a>
    
      <a class="sidebar-nav-item" href=/tag/react/>react</a>
    
      <a class="sidebar-nav-item" href=/tag/tutum/>tutum</a>
    
      <a class="sidebar-nav-item" href=/tag/aws/>aws</a>
    
      <a class="sidebar-nav-item" href=/tag/machine-learning/>machine-learning</a>
    
      <a class="sidebar-nav-item" href=/tag/angular/>angular</a>
    
      <a class="sidebar-nav-item" href=/tag/finance/>finance</a>
    
      <a class="sidebar-nav-item" href=/tag/books/>books</a>
    
      <a class="sidebar-nav-item" href=/tag/octave/>octave</a>
    
      <a class="sidebar-nav-item" href=/tag/kubernetes/>kubernetes</a>
    
      <a class="sidebar-nav-item" href=/tag/coreml/>coreml</a>
    
      <a class="sidebar-nav-item" href=/tag/ml/>ml</a>
    
      <a class="sidebar-nav-item" href=/tag/games/>games</a>
    
      <a class="sidebar-nav-item" href=/tag/ai/>ai</a>
    
      <a class="sidebar-nav-item" href=/tag/genai/>genai</a>
    
      <a class="sidebar-nav-item" href=/tag/godot/>godot</a>
    
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2023. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h2 class="masthead-title">
            <a href="/" title="Home">dimroc</a>
            <small>blog</small>
            <span class="masthead-links">
              <a href="https://experiments.dimroc.com" title="Experiments">See Experiments</a>
            </span>
          </h2>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Comparing Golang, Scala, Elixir, Ruby, and now Python3 for ETL: Part 2</h1>
  <span class="post-date">07 May 2015</span>
  <span class="post-comments"><a href="#disqus_thread"></a></span>
  <p>A year ago, I wrote the same program in four languages to compare their productivity when performing <a href="https://en.wikipedia.org/wiki/Extract,_transform,_load">ETL (extract-transform-load)</a>.
Read about <a href="/2014/09/29/etl-language-showdown/">part 1 here</a> and feel free to check out the <a href="https://github.com/dimroc/etl-language-comparison">source code</a>.</p>

<p>The code has changed, the languages have evolved, and the hardware now includes a SSD drive. So, where are they now?</p>

<p><em>Update: There is now also a <a href="/2015/11/14/etl-language-showdown-pt3/">part 3</a></em>
<!--more--></p>

<h2 id="results">Results</h2>

<table>
  <tr>
    <td>Ruby w/ Celluloid (Global Interpreter Lock Bound, single core)</td>
    <td>43.7s</td>
  </tr>

  <tr>
    <td>JRuby w/ Celluloid</td>
    <td>15.8s</td>
  </tr>

  <tr>
    <td>Ruby w/ <a href="https://github.com/grosser/parallel" target="_blank">grosser/parallel</a> (<b>not GNU Parallel</b>)</td>
    <td>10.9s</td>
  </tr>

  <tr>
    <td>Python w/ <a href="https://docs.python.org/2/library/multiprocessing.html" target="_blank">Pool</a></td>
    <td>12.7s</td>
  </tr>

  <tr>
    <td>Scala</td>
    <td>8.8s</td>
  </tr>

  <tr>
    <td>Scala w/ Substring <b>(Skipped regex for performance analysis)</b></td>
    <td>8.3s</td>
  </tr>

  <tr>
    <td>Golang</td>
    <td>32.8s</td>
  </tr>

  <tr>
    <td>Golang w/ Substring <b>(Skipped regex for performance analysis)</b></td>
    <td>7.8s</td>
  </tr>

  <tr>
    <td>Elixir</td>
    <td>21.8s</td>
  </tr>
</table>

<h2 id="recap">Recap</h2>

<p>The original goal was <strong>not</strong> to see how fast each language could go. Rather, it was was to measure the length of time needed to
write a solution and subjectively measure the maintainability of said solution, all while learning each language’s gotchas on the way.
But, in the end, everyone wants benchmarks.</p>

<p>It was assumed that runtimes would all be approximately the same, since this should have been an IO-bound problem. So why
care about the speed of the language? Well, on my old MacBook Pro with a 5200 RPM HDD, this was not true and, surprisingly, it still isn’t on my SSD.</p>

<h2 id="the-hardware">The Hardware</h2>

<p>MacBook Pro 2.3GHz i7 (quad core) with 16GB RAM and SSD</p>

<h2 id="the-problem">The Problem</h2>

<p>We have ~40M tweets spanning multiple files, with each tweet tagged with their New York City neighborhood. We want to discover which
neighborhoods care the most about the New York Knicks by searching for the term <code class="language-plaintext highlighter-rouge">knicks</code>.</p>

<h2 id="questions-and-concerns-from-part-1">Questions and Concerns from <a href="/2014/09/29/etl-language-showdown/">Part 1</a></h2>

<ol>
  <li>
    <p>Why was I writing to an intermediary file? Why didn’t I do it all in memory? Well, now I do.</p>

    <p>This comparison was derived from a larger ETL process that spanned multiple computers and therefore
 used intermediary files to pass along the information. This cookie-cutter experiment has no need for this,
 so it has been removed.</p>
  </li>
  <li>
    <p>Why am I using regex and not a simple string search (GoLang’s regex sucks in 1.x.x)?</p>

    <p>The implementations should be consistent across all languages for a fair comparison. Even though
 the problem is simply searching for <code class="language-plaintext highlighter-rouge">knicks</code>, I wanted the implementations to have the flexibility
 to perform more powerful searches. That being said, Golang’s Regexp package performs dramatically worse than other languages
 so I included results using <code class="language-plaintext highlighter-rouge">strings.Contains</code>.</p>
  </li>
  <li>
    <p>In Scala, why did I use Akka instead of the lighter Parallel Collections?</p>

    <p>Because I love Akka.</p>
  </li>
</ol>

<h2 id="implementation-changes">Implementation Changes</h2>

<h3 id="ruby">Ruby</h3>
<ul>
  <li>Ruby version is now 2.2.2.</li>
  <li>No longer uses GNU Parallel, but instead uses <a href="https://github.com/grosser/parallel">grosser/parallel</a> to span multiple cores.</li>
  <li>Implementation no longer writes to intermediary file.</li>
</ul>

<h3 id="scala">Scala</h3>
<ul>
  <li>Upgraded to Scala 2.11.5 and Akka 2.3.10.</li>
  <li>Reduction no longer writes to intermediary file.</li>
  <li>Still uses Akka. If you think the <a href="http://docs.scala-lang.org/overviews/parallel-collections/overview.html">Parallel Collections</a> library would be a better fit,
which it very well might be, please feel free to contribute a pull request.</li>
</ul>

<h3 id="python">Python</h3>
<ul>
  <li>Version python3-3.4.3</li>
  <li>A new Python implementation has been added for comparison’s sake.</li>
  <li>The <a href="https://docs.python.org/2/library/multiprocessing.html"><code class="language-plaintext highlighter-rouge">Pool</code> object</a> allows one to run the program on multiple processes and sidestep the Global Interpreter Lock (GIL).
  A pretty great alternative to my use of <a href="http://www.gnu.org/software/parallel/">GNU <code class="language-plaintext highlighter-rouge">parallel</code></a> with Ruby in <a href="/2014/09/29/etl-language-showdown/">part 1</a>.</li>
</ul>

<h3 id="elixir">Elixir</h3>
<ul>
  <li>Updated to Elixir version 1.0.4</li>
  <li>Reduction no longer writes to intermediary file.</li>
  <li>Actor model is beautiful in Elixir.</li>
  <li>No significant performance improvement when using String.contains instead of regex.</li>
  <li>Profiled with <a href="https://github.com/parroty/exprof">exprof</a> but didn’t see any low hanging fruit (I’m welcome to any feedback here).
  <img src="/public/images/etlElixirProfiling.jpg" alt="Elixir Profiling" /></li>
  <li>Changing</li>
</ul>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></code></pre></figure>

<p>to this</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="no">HashDict</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">...</span><span class="p">)</span></code></pre></figure>

<p>made a dramatic difference. It speaks to the youth of the Elixir.</p>

<p><a href="http://elixir-lang.org/getting-started/maps-and-dicts.html#maps">From the website:</a></p>

<blockquote>
  <p>Note: Maps were recently introduced into the Erlang VM with EEP 43. Erlang 17 provides a partial implementation of the EEP, where only “small maps” are supported. This means maps have good performance characteristics only when storing at maximum a couple of dozens keys. To fill in this gap, Elixir also provides the HashDict module which uses a hashing algorithm to provide a dictionary that supports hundreds of thousands keys with good performance.</p>
</blockquote>

<h3 id="golang">Golang</h3>

<ul>
  <li>Updated Golang to 1.4.2.</li>
  <li>Initial performance was a disappointing 30s+, so I dug in and used <a href="http://blog.golang.org/profiling-go-programs">pprof</a> to profile the code.
  <img src="/public/images/etlGolangRegexp.jpg" alt="Golang Profiling" /></li>
  <li>Go’s Regular Expression engine really is as slow as a previous commenter mentioned. Switching to <code class="language-plaintext highlighter-rouge">strings.Contains</code> took it to ~7s.</li>
  <li>They’ve been hyped before, and I’m going to hype them again: GoLang’s Channels are fantastic.</li>
</ul>

<p>A modification to the GoLang implementation liberally uses channels as a FIFO queue to great effect:</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="c">// Spawns N routines, after each completes runs all whendone functions</span>
<span class="k">func</span> <span class="n">Spawn</span><span class="p">(</span><span class="n">N</span> <span class="kt">int</span><span class="p">,</span> <span class="n">fn</span> <span class="k">func</span><span class="p">(),</span> <span class="n">whendone</span> <span class="o">...</span><span class="k">func</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">waiting</span> <span class="o">:=</span> <span class="kt">int32</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">k</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">k</span> <span class="o">+=</span> <span class="m">1</span> <span class="p">{</span>
    <span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">fn</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">atomic</span><span class="o">.</span><span class="n">AddInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="n">waiting</span><span class="p">,</span> <span class="o">-</span><span class="m">1</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">fn</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">whendone</span> <span class="p">{</span>
          <span class="n">fn</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>#####Usage</p>

<p>Note the channel <code class="language-plaintext highlighter-rouge">filenames</code> acting as a thread-safe queue.</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="n">filenames</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="o">*</span><span class="n">procs</span><span class="p">)</span>

<span class="n">Spawn</span><span class="p">(</span><span class="o">*</span><span class="n">procs</span><span class="p">,</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">filename</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">filenames</span> <span class="p">{</span>
    <span class="n">file</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">},</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Done"</span><span class="p">)</span> <span class="p">})</span></code></pre></figure>

<h2 id="conclusion">Conclusion</h2>

<ul>
  <li>It’s always a challenge (or a lot of fun) attempting to write the same thing in two languages, let alone five.
Each language’s idioms sway an implementation in a particular direction. Long story short, there are still a lot of discrepancies between the implementations.</li>
  <li>Elixir and Golang have matured dramatically in a year’s time.</li>
  <li>It is damn difficult to parse Scala code when you’ve been away for a while. It’s just… <strong>dense</strong>.</li>
  <li><a href="/2014/09/29/etl-language-showdown/">My previous conclusion</a> still holds up, check it out (it’s at the bottom of the link).</li>
  <li>This whole experiment has lived far longer than I thought.</li>
</ul>

<h2 id="think-you-can-do-better-want-to-see-another-language-contribute">Think you can do better? Want to see another language? Contribute.</h2>

<p>Submit a pull request with your code changes and I’ll update the doc.</p>

<h2 id="thanks">Thanks</h2>

<p>Thanks to all those who contributed to the repo:</p>

<ul>
  <li><a href="https://github.com/egonelbre">Egon Elbre</a> - Go</li>
  <li><a href="https://github.com/gbulmer">gbulmer</a> - Go</li>
  <li><a href="https://github.com/josevalim">José Valim</a> - Elixir</li>
  <li><a href="https://github.com/aheld">Aaron Held</a> - Python</li>
</ul>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2023/06/11/game-to-video-w-genai/">
            Game to Video: Using Generative AI to Uprender Gameplay
            <small>11 Jun 2023</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2019/12/31/books-worth-reading-2019/">
            Books Worth Reading 2019
            <small>31 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2018/12/31/books-worth-reading-2018/">
            Books Worth Reading 2018
            <small>31 Dec 2018</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'dimroc'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'dimroc'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
  var s = document.createElement('script'); s.async = true;
  s.type = 'text/javascript';
  s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>


  </body>
</html>
